# REST API

기본적으로 API를 설계할 때, **리소스를 식별하고, URI 계층 구조를 활용**한다.
리소스와 행위를 분리하라. 가장 중요한 것은 리소스를 식별하는 것.
리소스와 해당 리소스를 대상으로 하는 행위를 분리하라.
그렇다면 이 행위는 어떻게 구분할까? 바로 메서드를 사용하는 것이다.


## HTTP 메서드 종류
- GET
    - 리소스 조회
    - 서버에 전달하고 싶은 데이터는 query(쿼리 파라미터, 쿼리스트링)을 통해서 전달
    - 메세지 바디가 가능은 하지만 지원하지 않는 곳이 많아서 권장하지 않는다.
- POST
    - 메세지 바디를 통해 서버로 요청 데이터를 전달
    - 서버는 요청 데이터를 처리
    - 만능 -> 요청 데이터를 어떻게 처리할 지 정해진 것이 없음
    - 컨트롤 URI
    - 다른 메서드로 처리하기 애매한 경우에도 사용
- PUT
    - 리소스를 대체, 해당 리소스가 없으면 생성, 쉽게 이야기 해서 덮어쓰기
    - **클라이언트가 리소스 위치를 알고 URI 지정**
        - 이게 POST와의 차이점
- PATCH
    - 리소스 부분 변경
- DELETE
    - 리소스 삭제
- HEAD
    - GET과 동일하지만, 메세지 부분이 없고 상태 줄과 헤더만 반환
- OPTIONS
    - 대상 리소스에 대한 통신 가능 옵션(메서드)를 설명
    - 주로 CORS에서 사용
- CONNECT
    - 대상 리소스로 식별되는 서버에 대한 터널을 설정
- TRACE
    - 대상 리소스에 대한 경로를 따라 메세지 루프백 테스트를 수행



## HTTP 메서드의 속성
- 안전
    - 호출해도 리소스를 **변경하지 않는다.**
- 멱등
    - 여러 번 호출해도 결과가 똑같다
        - GET -> O
        - PUT -> O
        - DELETE -> O
        - POST -> X
    - 자동 복구 메커니즘
        - 서버가 정상응답을 못주었을 때 클라이언트가 같은 요청을 다시 해도 되는가?
    - 외부 요인으로 중간에 리소스가 변경되는 것까지는 고려하지 않는다.
- 캐시가능
    - 응답 결과 리소스를 캐시해서 사용해도 되는가?
    - GET, HEAD, POST, PATCH 캐시 가능
    - 실제로는 GET, HEAD 정도만 캐시로 사용
        - POST, PATCH는 본문 내용까지 캐시 키로 고려해야하는데, 구현이 쉽지 않음


## HTTP 메서드 활용

**데이터 전달방식은 크게 2가지**
- 쿼리 파라미터를 통한 데이터 전송
    - GET
    - 주로 정렬 필터(검색어)
- 메세지 바디를 통한 데이터 전송
    - POST, PUT, PATCH
    - 회원 가입, 상품 주문, 리소스 등록, 리소스 변경 …

**클라이언트가 서버에게 요청하는 방식은 크게 4가지**
- 정적 데이터 조회
    - 이미지, 정적 텍스트 문서
    - GET
    - 일반적으로 쿼리 파라미터 없이 리소스 경로로 단순하게 조회 가능
- 동적 데이터 조회
    - 주로 검색, 게시판 목록에서 정렬 필터(검색어)
    - 조회 조건을 줄여주는 필터, 조회 결과를 정렬하는 정렬 조건에 주로 사용
    - GET
    - 쿼리 파라미터를 사용해서 데이터를 전달
- HTML FORM을 통한 데이터 전송
    - GET, POST만 지원
    - GET
        - 조회 가능
        - 전송 데이터를 url encoding 처리한다.
            - 예) abc김 -> abc%EA%B9%80
    - POST
        - 쿼리 파라미터와 같은 형식(key,value)의 데이터가 Body에 포함되어 전달된다.
    - 파일업로드
        - POST
        - multipart/form-data
        - 다른 종류의 여러 파일과 폼의 내용 함께 전송


- HTML API를 통한 데이터 전송
    - 서버 to 서버
        - 백엔드 시스템 통신
    - 앱 클라이언트
    - 웹 클라이언트
        - React, VueJs 같은 웹 클라이언트와 API 통신
        - 자바 스크립트를 통한 통신 (Ajax)


## HTTP API 설계 예시
- HTTP API - 컬렉션
    - POST 기반 등록
    - 보통 컬렉션 사용
- HTTP API - 스토어
    - PUT 기반 등록
    - 정적 컨텐츠, 원격 파일 관리
- HTML FORM
    - 웹 페이지
    - GET, POST만 지원


**회원 관리 시스템 예시**

1. API 설계 - POST 기반 등록 (**컬렉션**) -> 주로 사용
- 회원 목록
    - GET
    - /members
- 회원 등록
    - POST
    - /members
    - **서버가 새로 등록된 리소스 URI을 관리한다.**
        - ex. Location: /members/100
- 회원 조회
    - GET
    - /members/{id}
- 회원 수정
    - PATCH, PUT, POST
    - members/{id}
- 회원 삭제
    - DELETE
    - members/{id}

컬렉션은 서버가 관리하는 리소스 디렉토리이다. 서버가 리소스의 URI을 생성하고 관리한다.
여기서 컬렉션은 /members 이다.


2. API 설계 - PUT 기반 등록 (**스토어**)

- 파일 목록
    - GET
    - /files
- 파일 조회
    - GET
    - /files/{filename}
- 파일 등록
    - PUT
    - /files/{filename}
- 파일 삭제
    - DELETE
    - /files/{filename}
- 파일 대량 등록
    - POST
    - /files

클라이언트가 리소스 URI을 알고 있어야 한다.
**클라이언트가 직접 리소스의 URI을 지정하는 것이다.**
즉, 스토어는 클라이언트가 관리하는 리소스 저장소이다.